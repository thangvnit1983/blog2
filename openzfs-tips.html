<!DOCTYPE html><html lang="vi"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Openzfs tips - Van Thang&#x27;s Blog</title><meta name="robots" content="index, follow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="canonical" href="https://thangvnit1983.github.io/blog2/openzfs-tips.html"><link rel="amphtml" href="https://thangvnit1983.github.io/blog2/amp/openzfs-tips.html"><link type="application/atom+xml" rel="alternate" href="https://thangvnit1983.github.io/blog2/feed.xml"><meta property="og:title" content="Openzfs tips"><meta property="og:site_name" content="My blog - Van Thang's Blog"><meta property="og:description" content="About SMR HDDAnother thing you might try is to leave the block size set at 1M but increase the zfs_vdev_aggregation_limit to 16M. This way as long as your doing 1M aligned IO you should never write partial blocks and leave holes. ZFS will aggregate these&hellip;"><meta property="og:url" content="https://thangvnit1983.github.io/blog2/openzfs-tips.html"><meta property="og:type" content="article"><link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link href="https://fonts.googleapis.com/css?family=Roboto:400,700%7CRoboto+Condensed:400,700&amp;subset=latin-ext" rel="stylesheet"><link rel="stylesheet" href="https://thangvnit1983.github.io/blog2/assets/css/style.css?v=8cd723f2dc4e7038901287147b115198"><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://thangvnit1983.github.io/blog2/openzfs-tips.html"},"headline":"Openzfs tips","datePublished":"2019-04-15T11:19","dateModified":"2019-04-15T11:19","description":"About SMR HDDAnother thing you might try is to leave the block size set at 1M but increase the zfs_vdev_aggregation_limit to 16M. This way as long as your doing 1M aligned IO you should never write partial blocks and leave holes. ZFS will aggregate these&hellip;","author":{"@type":"Person","name":"Van Thang"},"publisher":{"@type":"Organization","name":"Van Thang"}}</script><script async src="https://thangvnit1983.github.io/blog2/assets/js/lazysizes.min.js?v=fcb7109aacc796048242935c33a7f9ab"></script><style>.top__search [type=search] {
						background-image: url(https://thangvnit1983.github.io/blog2/assets/svg/search.svg);
				    }</style></head><body><div class="container"><header class="js-top is-sticky"><a class="logo" href="https://thangvnit1983.github.io/blog2">Van Thang&#x27;s Blog</a><div class="top"><nav class="navbar js-navbar"><button class="navbar__toggle js-navbar__toggle">Menu</button><ul class="navbar__menu"></ul></nav><div class="top__search"><form action="https://thangvnit1983.github.io/blog2/search.html" class="search"><input type="search" name="q" placeholder="search..."></form></div></div></header><main><article class="post"><div class="hero"><header class="hero__text"><h1>Openzfs tips</h1><p class="post__meta"><time datetime="2019-04-15T11:19">tháng 4 15, 2019 </time>By <a href="https://thangvnit1983.github.io/blog2/authors/van-thang/" rel="author" title="Van Thang">Van Thang</a></p></header></div><div class="post__entry"><h3 id="About-SMR-HDD"><a href="https://github.com/zfsonlinux/zfs/issues/4877" target="_blank" rel="external noopener noreferrer">About SMR HDD</a></h3><p>Another thing you might try is to leave the block size set at 1M but increase the zfs_vdev_aggregation_limit to 16M. This way as long as your doing 1M aligned IO you should never write partial blocks and leave holes. ZFS will aggregate these 1M blocks in to larger 16M IOs to the disk.</p><h3 id="6x-Intel-P3520">[6x Intel P3520]</h3><p>Before modify default parameter. there are only 1.xGB/s read or write. too slow…….</p><p><code></code></p><pre><span class="line">parted /dev/nvme0n1 p</span><br><span class="line">Model: Unknown (unknown)</span><br><span class="line">Disk /dev/nvme0n1: 2000GB</span><br><span class="line">Sector size (logical/physical): 512B/512B</span><br><span class="line">Partition Table: gpt</span><br><span class="line">Disk Flags:</span><br><br><span class="line">Number  Start   End     Size    File system  Name  Flags</span><br><span class="line"> 1      1049kB  1900GB  1900GB               disk1</span><br><br><span class="line">zpool destroy tank01</span><br><span class="line">zpool create tank01 -o ashift=13 -O recordsize=1M /dev/nvme{0..5}n1p1</span><br><span class="line"><span class="comment">###test mds</span></span><br><span class="line">zpool create <span class="_">-f</span> tank-mdt -O canmount=off -O xattr=sa -O acltype=posixacl -o ashift=12 -O recordsize=32k /dev/sd{b..d}</span><br><span class="line">zfs <span class="built_in">set</span> primarycache=metadata tank01</span><br><span class="line">zfs <span class="built_in">set</span> secondarycache=none tank01</span><br><span class="line">zfs <span class="built_in">set</span> logbias=throughput tank01</span><br><br><span class="line">...</span><br><span class="line">              capacity     operations     bandwidth</span><br><span class="line">pool        alloc   free   <span class="built_in">read</span>  write   <span class="built_in">read</span>  write</span><br><span class="line">----------  -----  -----  -----  -----  -----  -----</span><br><span class="line">tank01       132G  10.2T      0  16.7K      0  5.79G</span><br><span class="line">tank01       146G  10.2T      0  12.4K      0  7.22G</span><br><span class="line">tank01       161G  10.2T      0  10.9K      0  7.41G</span><br><span class="line">tank01       174G  10.1T      0  12.1K      0  7.18G</span><br><span class="line">...</span><br><span class="line">tank01       512G  9.81T  8.75K      0  8.75G      0</span><br><span class="line">tank01       512G  9.81T  8.78K     44  8.78G   864K</span><br><span class="line">tank01       512G  9.81T  8.85K      0  8.85G      0</span><br><span class="line">tank01       512G  9.81T  8.76K     53  8.76G   876K</span><br><span class="line">tank01       512G  9.81T  8.80K      0  8.80G      0</span><br><span class="line">tank01       512G  9.81T  8.78K     40  8.78G   876K</span><br><span class="line">...</span><br><span class="line">tank01       779G  9.55T  3.94K  4.37K  3.94G  3.99G</span><br><span class="line">tank01       787G  9.54T  3.99K  4.31K  3.99G  3.91G</span><br><span class="line">tank01       793G  9.54T  3.96K  4.32K  3.96G  3.99G</span><br><span class="line">tank01       801G  9.53T  3.94K  4.40K  3.94G  3.94G</span><br><span class="line">tank01       809G  9.52T  3.90K  4.32K  3.90G  3.92G</span><br><span class="line">tank01       818G  9.51T  3.96K  4.36K  3.96G  3.96G</span><br><span class="line">tank01       826G  9.51T  3.90K  4.41K  3.91G  4.02G</span><br><span class="line">tank01       834G  9.50T  3.94K  4.31K  3.94G  3.89G</span></pre><p><code></code></p><p class="post__last-updated">This article was updated on tháng 4 15, 2019</p></div><aside class="post__share"></aside><footer class="post__footer"><div class="post__bio"><h3><a href="https://thangvnit1983.github.io/blog2/authors/van-thang/" class="inverse" title="Van Thang">Van Thang</a></h3></div><nav class="post__nav"><div class="post__nav__prev">Previous Post<h5><a href="https://thangvnit1983.github.io/blog2/test.html" class="inverse" rel="prev">Test</a></h5></div></nav></footer></article></main><footer class="footer"><div class="footer__copyright">Powered by Publii</div></footer></div><script defer="defer" src="https://thangvnit1983.github.io/blog2/assets/js/jquery-3.2.1.slim.min.js?v=5f48fc77cac90c4778fa24ec9c57f37d"></script><script defer="defer" src="https://thangvnit1983.github.io/blog2/assets/js/scripts.min.js?v=5dffffceea1fdc07740088873ba7ff09"></script></body></html>